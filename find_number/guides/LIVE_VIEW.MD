# Fiche LiveView

## C'est quoi ? Ca sert √† quoi ?

Les LiveViews sont une fonctionnalit√© du framework Elixir, Phoenix. Gr√¢ce aux LiveViews, vous pourrez cr√©er des interfaces utilisateurs en Elixir tr√®s facilement sans √©crire une seule ligne de Javascript. En bref, c'est le turfu ! üöÄ

L'avantage:

- on peut faire du front sophistiqu√© dans le back et donc avoir un seul "code base".
- pas besoin de mettre en place une SPA (application Javascript en React, Vue ou Angular, r√©put√© pour √™tre lourd √† mettre en place) pour faire des composants front sophistiqu√©.
- pas besoin de changer de language, vous pouvez rester qu'avec Elixir pour faire une application compl√®te
- si vous avez besoin d'utiliser du Javascript, il existe des "bindings" (m√©canisme de liaison entre le JS et Elixir) pour connecter du code JS √† vos LiveViews

En r√©sum√©:

- Enorme productivit√©.

Les LiveViews sont un nouveau paradigme tr√®s prometteur qui ont pu voir le jour seulement gr√¢ce √† la puissance de la BEAM (machine virtuelle Erlang qui permet de lancer des applications Elixir et Phoenix). (Bon courage pour mettre en place √ßa avec Rails üòÑ)

Pour plus d'infos, vous avez [un chouette talk ici](https://www.youtube.com/watch?v=8xJzHq8ru0M).

## Boilerplate

Boilerplate, c'est un mot anglais qui veut dire "code de base" (pour lancer un projet).

```elixir
defmodule MyAppWeb.XXXLive do
  use Phoenix.LiveView

  def render(assigns) do
    ~L"""
    <h1>XXXX</h1>
    """
  end
end
```

C'est dans la fonction render que vous allez mettre votre code HTML.

## Initialiser le state de la LiveView:

Le state correspond √† l'ensemble des donn√©es propre √† notre LiveView qui sont susceptibles d'√™tre **modifi√©**.
Ex: pour un compteur, le state correspondra √† l'ensemble des valeurs susceptibles d'√™tre modifi√©. En particulier, on aura qu'une seule valeur, la valeur du compteur (`:count_value`, dans le code ci-dessous).

Pour initialiser du state dans une LiveView, on ajoute la fonction `mount/2` dans le module comme ci-dessous, et on assign les valeurs n√©cessaires.

```elixir
def mount(_, socket) do
   {:ok, socket
            |> assign(:count_value, 0)
            |> assign(:value2, "value 2")
   }
end
```

## Acc√©der aux valeurs du state (assigns):

Les valeurs du state sont dans `socket.assigns`.

Ex: Pour acc√©der √† `:count_value`, on fait: `socket.assigns.count_value`.

Dans le HTML, vous pouvez afficher votre valeur ainsi:

```elixir
  def render(assigns) do
    ~L"""
    <h1><%= @count_value %></h1>
    """
  end
```

## Changer valeur du state (assigns):

Pour changer la valeur du state, on utilise la fonction `assign/3`. [assign(socket, cl√©, nouvelle valeur)]

```elixir
socket |> assign(:count_value, socket.assigns.count_value + 10)
```

## Ajouter une action

Dans le render, ajouter `phx-click` ou un autre [event-binding](https://hexdocs.pm/phoenix_live_view/Phoenix.LiveView.html#module-bindings) dans le bon √©lement HTML.

Ex:

```elixir
<button phx-click="change_value">Change value</button>
```

Puis, dans le module, ajouter la fonction qui va g√©rer l'action:

```elixir
def handle_event("change_value", _, socket) do
   {:noreply, socket |> assign(:count_value, socket.assigns.count_value + 10)}
end
```

## Ecrire une condition

Vous pouvez √©crire une condition dans le render ainsi:

```elixir
<%= if @value > 0 do %>
  <h2>C'est un nombre positif</h2>
<% end %>
```

## G√©rer le CSS

Vous pouvez g√©rer le CSS dans le fichier `assets/css/app.css`.

## M√©thode de travail

Quand vous avez un probl√®me, posez vous les 3 questions du MVC:

- quelles sont mes donn√©es? (Model ou state)
- √† quoi va ressembler mon interface visuelle (View)
- quels sont les interactions/actions que je dois mettre en place? (Controller)

Ainsi, vous divisez votre fonctionnalit√© en 3 sous-probl√®mes que vous devez r√©soudre:

- donn√©es: lister les donn√©es susceptibles de changer en cours de route, puis assignez les dans `socket` lors du mount
- interface visuelle: poser le html de la LiveView dans le render
- interaction/action: cr√©er les √©v√©nements correspondants √† votre fonctionnalit√© et les fonctions qui vont les traiter
